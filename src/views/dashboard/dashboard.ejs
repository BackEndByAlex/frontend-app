<link rel="stylesheet" href="css/dashboard.css">
<script type="module" src="/js/password.js"></script>
<script type="module" src="/js/checkSession.js"></script>

<div class="dashboard-page">
  <%- include('../partials/flashmeddelande') %>

  <h1>V√§lkommen, <%= user?.name %> üëã</h1>

  <% if (!isCodeVerified) { %>
    <div class="dashboard-card">
      <h2>Verifiera din kod</h2>
      <form action="/verify-code" method="POST" class="verify-form">
        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
        <input type="text" name="code" placeholder="Ange din kod h√§r" required />
        <button type="submit" class="btn-primary">Verifiera</button>
      </form>
    </div>
  <% } else { %>
    <div class="dashboard-card">
      <h2>Generera ett s√§kert l√∂senord</h2>
    
      <div class="password-generator">
        <div class="password-input-wrapper">
          <input type="text" id="generated-password" readonly placeholder="H√§r kommer ditt l√∂senord..." />
    
          <div class="password-icons">
            <button type="button" id="toggle-password-visibility" class="icon-btn">
              <!-- √ñGA SVG -->
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 5c-7.633 0-11 7-11 7s3.367 7 11 7 11-7 11-7-3.367-7-11-7zm0 12c-2.761 0-5-2.239-5-5s2.239-5 5-5 5 2.239 5 5-2.239 5-5 5zm0-8c-1.657 0-3 1.343-3 3s1.343 3 3 3 3-1.343 3-3-1.343-3-3-3z"/>
              </svg>
            </button>
    
            <button type="button" id="copy-password" class="icon-btn">
              <!-- KOPIERA SVG -->
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                <path d="M19 21H9c-1.1 0-2-.9-2-2v-10h2v10h10v2zM15 17H5c-1.1 0-2-.9-2-2V5c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2v10c0 1.1-.9 2-2 2zm0-12H5v10h10V5z"/>
              </svg>
            </button>
          </div>
        </div>
    
        <form id="save-password-form" action="/save-password" method="POST" class="save-password-form">
          <input type="hidden" name="_csrf" value="<%= csrfToken %>">
        
          <input type="text" name="service" placeholder="Tj√§nstens namn" required>
          <input type="text" name="username" placeholder="Anv√§ndarnamn f√∂r tj√§nsten" required>
        
          <input type="text" id="password-field" name="password" placeholder="H√§r kommer ditt l√∂senord..." required>
        
          <div class="password-buttons">
            <button type="button" id="generate-password" class="btn-primary">Generera l√∂senord</button>
            <button type="submit" class="btn-success">Spara l√∂senord</button>
          </div>
        </form>
      </div>
    </div>       
  <% } %>
  <% if (typeof passwords !== 'undefined' && passwords.length > 0) { %>
    <div class="saved-passwords">
      <h3>Sparade l√∂senord</h3>
      <table>
        <thead>
          <tr>
            <th>Tj√§nst</th>
            <th>Anv√§ndarnamn</th>
            <th>L√∂senord</th>
          </tr>
        </thead>
        <tbody>
          <% passwords.forEach(entry => { %>
            <tr>
              <td><%= entry.service %></td>
              <td><%= entry.username %></td>
              <td><%= entry.password %></td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  <% } else if (isCodeVerified) { %>
    <p>Inga sparade l√∂senord √§nnu.</p>
  <% } %>  
</div>


